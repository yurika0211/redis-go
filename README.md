# ğŸ“¦ go-redis-clone

`go-redis-clone` æ˜¯ä¸€ä¸ªç”¨ **Goè¯­è¨€** å®ç°çš„è½»é‡çº§ Redis å…‹éš†é¡¹ç›®ï¼Œæ—¨åœ¨å­¦ä¹  Redis çš„åº•å±‚åŸç†ä¸é«˜æ€§èƒ½ç½‘ç»œæœåŠ¡è®¾è®¡ã€‚  
é¡¹ç›®ä¸¥æ ¼éµå¾ª Redis çš„ **RESP åè®®**ï¼Œå®ç°äº†å¸¸è§çš„äº”ç§æ ¸å¿ƒæ•°æ®ç»“æ„ä¸å‘½ä»¤åˆ†å‘æœºåˆ¶ã€‚

---

## ğŸ§© é¡¹ç›®ç»“æ„

```
go-redis-server/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/
â”‚       â””â”€â”€ main.go           # ç¨‹åºå…¥å£
â”œâ”€â”€ go.mod                    
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ command/               # å‘½ä»¤æ³¨å†Œä¸åˆ†å‘
â”‚   â”‚   â””â”€â”€ command.go        
â”‚   â”œâ”€â”€ core/                  # æ ¸å¿ƒæœåŠ¡
â”‚   â”‚   â””â”€â”€ server.go         
â”‚   â”œâ”€â”€ data/                  # å„æ•°æ®ç»“æ„å®ç°
â”‚   â”‚   â”œâ”€â”€ common.go         
â”‚   â”‚   â””â”€â”€ string.go         
â”‚   â”‚   â””â”€â”€ hash.go       
â”‚   â”‚   â””â”€â”€ list.go 
â”‚   â”‚   â””â”€â”€ set.go
â”‚   â”‚   â””â”€â”€ sortedset.go                    
â”‚   â”œâ”€â”€ db/                    # æ•°æ®åº“æ ¸å¿ƒé€»è¾‘
â”‚   â”‚   â”œâ”€â”€ db.go             
â”‚   â”‚   â””â”€â”€ db_test.go        
â”‚   â”‚   â””â”€â”€ string.go       
â”‚   â”‚   â””â”€â”€ hash.go       
â”‚   â”‚   â””â”€â”€ list.go       
â”‚   â”‚   â””â”€â”€ set.go       
â”‚   â”‚   â””â”€â”€ srotedset.go      
â”‚   â”œâ”€â”€ error/
â”‚   â”‚   â””â”€â”€ error.go        
â”‚   â”œâ”€â”€ protocol/              
â”‚   â”‚   â”œâ”€â”€ resp_parser.go    
â”‚   â”‚   â””â”€â”€ resp_writer.go    
â”‚   â”œâ”€â”€ persistence/           # â† æ–°å¢ç›®å½•ï¼šæŒä¹…åŒ–é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ rdb.go            
â”‚   â”‚   â””â”€â”€ aof.go          
â”‚   â”‚   â””â”€â”€ rdb_test.go
â”‚   â”‚   â””â”€â”€ aof_test.go
â”‚   â””â”€â”€ utils/
â”œâ”€â”€ log/
â”‚   â””â”€â”€ aof.txt
â”‚   â””â”€â”€ RDB.rdb
â””â”€â”€ README.md                 
```


---

## âš™ï¸ åŠŸèƒ½ç‰¹æ€§
- ğŸ§  æ”¯æŒäº”ç§æ ¸å¿ƒæ•°æ®ç»“æ„ï¼ˆStringã€Listã€Hashã€Setã€SortedSetï¼‰  
- ğŸ”Œ ä½¿ç”¨ `net` åº“å®ç° TCP æœåŠ¡ï¼Œæ”¯æŒå¤šå®¢æˆ·ç«¯å¹¶å‘  
- ğŸ—£ï¸ å®Œå…¨éµå¾ª Redis RESP åè®®ï¼Œå¯ç”¨ Redis-cli è¿æ¥  
- ğŸ“– å‘½ä»¤æ³¨å†Œä¸åŠ¨æ€åˆ†å‘æœºåˆ¶  
- ğŸ§° æ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºæ‰©å±•æ›´å¤šå‘½ä»¤æˆ–æŒä¹…åŒ–æœºåˆ¶  

---

## ğŸš€ å¯åŠ¨æ–¹å¼
```bash
cd cmd/server
go run main.go
```

ç„¶åä½¿ç”¨ redis-cli è¿æ¥ï¼š

```
redis-cli -p 6379
```

ğŸ“Š é€»è¾‘ç»“æ„å›¾ï¼ˆASCIIï¼‰

```
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   redis-cli å®¢æˆ·ç«¯ â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚  RESP åè®®
                    â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  TCP Server (Go)   â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
          â”‚ è¯·æ±‚è§£æ  â”‚  å“åº”å°è£… â”‚
          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      Command æ‰§è¡Œå™¨   â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    å†…å­˜æ•°æ®åº“ (map)   â”‚
        â”‚ String/List/Set/ZSet  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

## benchmarkæµ‹è¯•

æµ‹è¯•æŒ‡ä»¤

```bash
# è¿è¡Œæ‰€æœ‰ benchmark
go test -bench=. -benchmem .// -benchtime=10s

# åªè¿è¡Œ SET ç›¸å…³çš„ benchmark
go test -bench=BenchmarkSET -benchmem .// -benchtime=10s

# æŒ‡å®š CPU æ ¸å¿ƒæ•°ï¼ˆæ¨¡æ‹Ÿä¸åŒå¹¶å‘ç¯å¢ƒï¼‰
go test -bench=. -cpu=1,2,4,8 -benchmem .// -benchtime=10s

# ç”Ÿæˆ benchmark ç»Ÿè®¡
go test -bench=. -benchmem .// -benchtime=10s > bench_result.txt
```

benchmarkç»“æœ
```bash
BenchmarkSET_Sequential-20      13475690   913.0 ns/op   64 B/op   5 allocs/op
BenchmarkGET_Sequential-20      14096358   873.0 ns/op   32 B/op   3 allocs/op
BenchmarkSET_Concurrent-20      70765888   180.1 ns/op   64 B/op   5 allocs/op
```
![Benchmark å›¾](go-redis-server/images/benchmark.png)

ğŸ’¡ æœªæ¥è®¡åˆ’

 å®ç° RDB/AOF æŒä¹…åŒ–

 æ”¯æŒäº‹åŠ¡ï¼ˆMULTI/EXECï¼‰

 å®ç°è®¢é˜…å‘å¸ƒï¼ˆPub/Subï¼‰

 æ”¯æŒå¼‚æ­¥ IO æ¨¡å‹
